---
title: "p8105_mtp_gw2383"
author: "Guojing Wu"
date: "2018/10/17"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(patchwork)
theme_set(theme_bw())
```

## read and tidy data

```{r, cache = TRUE, message = FALSE}
# change rhe cache parameter!!!!
# is format_time necessary?

activity_df = 
  read_csv("./data/p8105_mtp_data.csv") %>% 
  janitor::clean_names() %>% 
  gather(key = act_time, value = count, activity_1:activity_1440) %>% # make it recordable
  mutate(
    day = factor(day, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")), 
    week = factor(week)) %>% 
  arrange(week, day) # reordering the rows by 'day' to make it more readable
```

the data is collected across `r dim(distinct(activity_df, week, day))[1]` days (`r dim(distinct(activity_df, week))[1]` weeks), and each day we collected the activity data `r dim(distinct(activity_df, act_time))[1]` times.

<!--
A spaghetti plot: total_count over each week:

```{r, fig.height = 160, dpi = 300}
activity_df %>%
  group_by(week, day) %>%
  summarise(total_act = sum(count)) %>%
  ggplot(aes(x = day, y = total_act, group = week, color = as.character(week))) +
  scale_y_log10() +
  geom_line()
```
-->

A boxplot: distribution over each week:
```{r, fig.height = 4, out.width = "90%", dpi = 300}
activity_df %>% 
  group_by(week, day) %>% 
  summarise(total_act = sum(count)) %>% 
  ggplot(aes(x = week, y = total_act, group = week)) +
  geom_boxplot() +
  labs(
    y = "Sum of activity counts", 
    caption = "Fig.1 boxplot for sum of each day's counts between weeks"
  ) +
  theme(
    axis.text.x = element_text(size = 5), 
    plot.caption = element_text(hjust = -0.2, size = 10)
  )
```

Here we can see that for each week there are some ourliers. And the whole `week 3` was collapsed into one dot, the proportion of value `1` within `week 3` is as high as `r activity_df %>% filter(week == 3) %>% summarise(prop = sum(count == 1) / length(count)) * 100`%.

## activity over time

```{r, out.width = "90%", dpi = 300}
# aggregate the count data across minutes
cross_min = activity_df %>% 
  group_by(week, day) %>% 
  summarise(sum_byday = sum(count))

ggplot(data = cross_min, aes(x = c(1:length(sum_byday)), y = sum_byday)) +
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  labs(
    x = "day", 
    y = "sum of each day's counts", 
    caption = "Fig.2 scatterplot for sum of each day's counts between days"
  ) +
  theme(
    plot.caption = element_text(hjust = -0.2, size = 10)
    )
```

Here we can see the linear regression line, the slope is positive: `r summary(lm(sum_byday ~ c(1:length(sum_byday)), cross_min))$coefficient[2,1]` and the p-value is very significant (`r summary(lm(sum_byday ~ c(1:length(sum_byday)), cross_min))$coefficient[2,4]`). Which suggest that this participant became more active over time.

Is day of the week affects the activity?(in isolation and in additon to the effect of time)

```{r, dpi = 300, out.width = "90%", message = FALSE}
# line
in_isolation = 
  activity_df %>% 
  group_by(day) %>% 
  summarise(sum_byweek = sum(count)) %>% 
  ggplot(aes(x = day, y = sum_byweek, group = 1)) +
  geom_point() +
  geom_line() +
  labs(
    y = "sum of activity counts", 
    title = "A)"
  ) + 
  theme(title = element_text(size = 8))

in_addition = 
cross_min %>% 
  ggplot(aes(x = week, y = sum_byday, group = day, col = day)) +
  geom_smooth(se = FALSE) +
  labs(
    y = "sum of activity counts", 
    title = "B)", 
    caption = "Fig.3 A) Relationship between day of the week and activity in isolation to the effect of time.\n B) Relationship between day of the week and activit in addition to the effect of time"
  ) +
  theme(
    axis.text.x = element_text(size = 5),
    title = element_text(size = 8), 
    plot.caption = element_text(hjust = -0.2, size = 10)
  )

in_isolation / in_addition
```

<!-- ```{r, dpi = 300, out.width = "90%"} -->
<!-- # boxplot -->
<!-- activity_df %>%  -->
<!--   ggplot(aes(x = day, y = count, group = day)) + -->
<!--   geom_boxplot() + -->
<!--   scale_y_log10() + -->
<!--   labs( -->
<!--     y = "sum of activity counts",  -->
<!--     title = "sum of each weekday's counts" -->
<!--   ) -->
<!-- ``` -->



